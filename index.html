<!DOCTYPE html>
<html lang="sv">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Avanza Trading Helper - Komplett Guide</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Helvetica', 'Arial', sans-serif;
            background: #0D1F2D;
            color: #FFFFFF;
            line-height: 1.6;
        }
        
        /* Avanza Colors */
        :root {
            --avanza-green: #00C281;
            --avanza-dark: #0D1F2D;
            --avanza-darker: #091420;
            --avanza-card: #1A2F3D;
            --avanza-red: #FF3B30;
            --avanza-blue: #007AFF;
            --text-primary: #FFFFFF;
            --text-secondary: #8E8E93;
        }
        
        /* Header */
        .header {
            background: var(--avanza-darker);
            padding: 20px;
            text-align: center;
            border-bottom: 3px solid var(--avanza-green);
            box-shadow: 0 2px 10px rgba(0,0,0,0.3);
        }
        
        .header h1 {
            color: var(--avanza-green);
            font-size: 1.8em;
            margin-bottom: 5px;
        }
        
        .header p {
            color: var(--text-secondary);
            font-size: 0.95em;
        }
        
        /* Container */
        .container {
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
        }
        
        /* Card */
        .card {
            background: var(--avanza-card);
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 20px;
            border: 1px solid rgba(255,255,255,0.1);
        }
        
        .card h2 {
            color: var(--avanza-green);
            margin-bottom: 20px;
            font-size: 1.6em;
        }
        
        .card h3 {
            color: var(--text-primary);
            margin: 20px 0 15px 0;
            font-size: 1.2em;
        }
        
        /* Search Section */
        .search-container {
            background: var(--avanza-darker);
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        
        .search-box {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }
        
        .search-box input {
            flex: 1;
            padding: 14px;
            background: var(--avanza-card);
            border: 2px solid rgba(255,255,255,0.1);
            border-radius: 8px;
            color: var(--text-primary);
            font-size: 16px;
        }
        
        .search-box input:focus {
            outline: none;
            border-color: var(--avanza-green);
        }
        
        .search-box button {
            padding: 14px 30px;
            background: var(--avanza-green);
            border: none;
            border-radius: 8px;
            color: white;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .search-box button:hover {
            background: #00A870;
            transform: translateY(-2px);
        }
        
        .stock-result {
            display: none;
            background: rgba(0, 194, 129, 0.1);
            border: 2px solid var(--avanza-green);
            border-radius: 8px;
            padding: 20px;
            margin-top: 15px;
        }
        
        .stock-result.show {
            display: block;
            animation: fadeIn 0.3s ease;
        }
        
        .stock-info {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
        }
        
        .stock-info-item {
            text-align: center;
        }
        
        .stock-info-label {
            color: var(--text-secondary);
            font-size: 0.9em;
            margin-bottom: 5px;
        }
        
        .stock-info-value {
            font-size: 1.3em;
            font-weight: bold;
            color: var(--avanza-green);
        }
        
        /* Input Groups */
        .input-group {
            margin-bottom: 20px;
        }
        
        .input-group label {
            display: block;
            margin-bottom: 8px;
            color: var(--text-secondary);
            font-weight: 500;
        }
        
        .input-group input,
        .input-group select {
            width: 100%;
            padding: 14px;
            background: var(--avanza-darker);
            border: 2px solid rgba(255,255,255,0.1);
            border-radius: 8px;
            color: var(--text-primary);
            font-size: 16px;
            transition: all 0.3s;
        }
        
        .input-group input:focus,
        .input-group select:focus {
            outline: none;
            border-color: var(--avanza-green);
            background: rgba(0, 194, 129, 0.05);
        }
        
        .input-group small {
            display: block;
            margin-top: 5px;
            color: var(--text-secondary);
            font-size: 0.85em;
        }
        
        /* Risk Selector */
        .risk-selector {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 12px;
            margin: 20px 0;
        }
        
        .risk-option {
            padding: 15px;
            background: var(--avanza-darker);
            border: 2px solid rgba(255,255,255,0.1);
            border-radius: 8px;
            cursor: pointer;
            text-align: center;
            transition: all 0.3s;
        }
        
        .risk-option:hover {
            transform: translateY(-2px);
            border-color: var(--avanza-green);
        }
        
        .risk-option.active {
            border-color: var(--avanza-green);
            background: rgba(0, 194, 129, 0.1);
        }
        
        .risk-emoji {
            font-size: 2em;
            margin-bottom: 5px;
        }
        
        .risk-name {
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .risk-details {
            font-size: 0.85em;
            color: var(--text-secondary);
        }
        
        /* Buttons */
        .button {
            width: 100%;
            padding: 16px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            margin-top: 10px;
        }
        
        .button-primary {
            background: var(--avanza-green);
            color: white;
        }
        
        .button-primary:hover {
            background: #00A870;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 194, 129, 0.4);
        }
        
        /* Results Box */
        .result-box {
            background: rgba(0, 194, 129, 0.1);
            border: 2px solid var(--avanza-green);
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
            display: none;
        }
        
        .result-box.show {
            display: block;
            animation: fadeIn 0.3s ease;
        }
        
        .result-row {
            display: flex;
            justify-content: space-between;
            padding: 12px 0;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }
        
        .result-row:last-child {
            border-bottom: none;
        }
        
        .result-label {
            color: var(--text-secondary);
        }
        
        .result-value {
            font-weight: bold;
            font-size: 1.1em;
        }
        
        .result-value.positive {
            color: var(--avanza-green);
        }
        
        .result-value.negative {
            color: var(--avanza-red);
        }
        
        /* Tabs */
        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            overflow-x: auto;
        }
        
        .tab {
            padding: 12px 24px;
            background: var(--avanza-darker);
            border: 2px solid rgba(255,255,255,0.1);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            white-space: nowrap;
            font-weight: 500;
        }
        
        .tab:hover {
            border-color: var(--avanza-green);
        }
        
        .tab.active {
            background: rgba(0, 194, 129, 0.2);
            border-color: var(--avanza-green);
            color: var(--avanza-green);
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
            animation: fadeIn 0.3s ease;
        }
        
        /* Guide Steps */
        .guide-step {
            background: var(--avanza-darker);
            border-radius: 8px;
            padding: 20px;
            margin: 15px 0;
            border-left: 4px solid var(--avanza-green);
        }
        
        .guide-step h4 {
            color: var(--avanza-green);
            margin-bottom: 12px;
            font-size: 1.1em;
        }
        
        .guide-step p {
            margin: 8px 0;
            line-height: 1.8;
        }
        
        .highlight-value {
            display: inline-block;
            background: var(--avanza-green);
            color: white;
            padding: 4px 12px;
            border-radius: 6px;
            font-weight: bold;
            margin: 0 3px;
        }
        
        .highlight-red {
            background: var(--avanza-red);
        }
        
        .highlight-blue {
            background: var(--avanza-blue);
        }
        
        /* Alert Boxes */
        .alert {
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            border-left: 4px solid;
        }
        
        .alert-info {
            background: rgba(0, 122, 255, 0.1);
            border-color: var(--avanza-blue);
        }
        
        .alert-warning {
            background: rgba(255, 149, 0, 0.1);
            border-color: #FF9500;
        }
        
        .alert-success {
            background: rgba(0, 194, 129, 0.1);
            border-color: var(--avanza-green);
        }
        
        .alert strong {
            display: block;
            margin-bottom: 5px;
        }
        
        /* Loading */
        .loading {
            text-align: center;
            padding: 20px;
            color: var(--text-secondary);
        }
        
        .spinner {
            border: 3px solid rgba(255,255,255,0.1);
            border-top: 3px solid var(--avanza-green);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 10px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        /* Mobile Responsive */
        @media (max-width: 768px) {
            .header h1 {
                font-size: 1.4em;
            }
            
            .container {
                padding: 15px;
            }
            
            .card {
                padding: 20px;
            }
            
            .search-box {
                flex-direction: column;
            }
            
            .tabs {
                flex-direction: column;
            }
            
            .tab {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <div class="header">
        <h1>üìä Avanza Trading Helper</h1>
        <p>S√∂k certifikat, ber√§kna niv√•er & l√§r dig handla s√§kert</p>
    </div>
    
    <!-- Container -->
    <div class="container">
        
        <!-- Section 1: Search & Calculator -->
        <div class="card">
            <h2>üîç 1. S√∂k & Ber√§kna</h2>
            
            <!-- Alpha Vantage Search -->
            <div class="search-container">
                <h3>S√∂k aktier & certifikat</h3>
                <div class="alert alert-info" style="margin-bottom: 15px;">
                    <strong>üí° Hur s√∂ker jag?</strong>
                    <p style="margin-top: 8px;">Skriv ticker-symbolen och tryck s√∂k!</p>
                    <p style="margin-top: 5px;"><strong>Exempel:</strong> AAPL (Apple), TSLA (Tesla), MSFT (Microsoft)</p>
                </div>
                
                <div class="search-box">
                    <input type="text" id="searchInput" placeholder="Ticker (t.ex. AAPL, TSLA, MSFT)" style="text-transform: uppercase;">
                    <button onclick="searchStock()">üîç S√∂k</button>
                </div>
                
                <div id="stockResult" class="stock-result">
                    <div class="stock-info">
                        <div class="stock-info-item">
                            <div class="stock-info-label">Namn</div>
                            <div class="stock-info-value" id="stockName">-</div>
                        </div>
                        <div class="stock-info-item">
                            <div class="stock-info-label">Ticker</div>
                            <div class="stock-info-value" id="stockTicker">-</div>
                        </div>
                        <div class="stock-info-item">
                            <div class="stock-info-label">Pris</div>
                            <div class="stock-info-value" id="stockPrice">-</div>
                        </div>
                        <div class="stock-info-item">
                            <div class="stock-info-label">F√∂r√§ndring</div>
                            <div class="stock-info-value" id="stockChange">-</div>
                        </div>
                    </div>
                    <button class="button button-primary" onclick="useStockPrice()" style="margin-top: 15px;">
                        ‚úì Anv√§nd detta pris i kalkylatorn
                    </button>
                </div>
            </div>
            
            <!-- Calculator -->
            <h3 style="margin-top: 30px;">Kalkylator</h3>
            
            <div class="input-group">
                <label>Ink√∂pspris (kr/st)</label>
                <input type="number" id="buyPrice" placeholder="18.87" step="0.01">
                <small>üí° Fyll i automatiskt genom att s√∂ka ovan, eller skriv manuellt</small>
            </div>
            
            <div class="input-group">
                <label>Antal certifikat</label>
                <input type="number" id="quantity" placeholder="15">
            </div>
            
            <div class="input-group">
                <label>H√§vst√•ng</label>
                <select id="leverage">
                    <option value="2">X2 (Rekommenderas f√∂r nyb√∂rjare)</option>
                    <option value="3">X3</option>
                    <option value="5">X5</option>
                    <option value="10">X10 (Mycket riskabelt)</option>
                    <option value="15">X15 (Extremt riskabelt)</option>
                </select>
            </div>
            
            <h3>V√§lj risk-niv√•</h3>
            <div class="risk-selector">
                <div class="risk-option" onclick="selectRisk('low')">
                    <div class="risk-emoji">üü¢</div>
                    <div class="risk-name">F√∂rsiktig</div>
                    <div class="risk-details">-10% / +20%</div>
                </div>
                <div class="risk-option active" onclick="selectRisk('balanced')">
                    <div class="risk-emoji">üü°</div>
                    <div class="risk-name">Balanserad</div>
                    <div class="risk-details">-15% / +30%</div>
                </div>
                <div class="risk-option" onclick="selectRisk('aggressive')">
                    <div class="risk-emoji">üî¥</div>
                    <div class="risk-name">Aggressiv</div>
                    <div class="risk-details">-20% / +40%</div>
                </div>
            </div>
            
            <button class="button button-primary" onclick="calculate()">
                üßÆ Ber√§kna niv√•er
            </button>
            
            <!-- Results -->
            <div id="results" class="result-box">
                <h3 style="color: var(--avanza-green); margin-bottom: 15px;">üìä Dina ber√§knade niv√•er:</h3>
                <div class="result-row">
                    <span class="result-label">Total investering:</span>
                    <span class="result-value" id="totalInvestment">0 kr</span>
                </div>
                <div class="result-row">
                    <span class="result-label">üõë Stop Loss Trigger:</span>
                    <span class="result-value negative" id="slTrigger">0 kr</span>
                </div>
                <div class="result-row">
                    <span class="result-label">üõë Stop Loss Limit:</span>
                    <span class="result-value negative" id="slLimit">0 kr</span>
                </div>
                <div class="result-row">
                    <span class="result-label">Max f√∂rlust:</span>
                    <span class="result-value negative" id="maxLoss">0 kr</span>
                </div>
                <div class="result-row">
                    <span class="result-label">üéØ Take Profit Limit:</span>
                    <span class="result-value positive" id="tpLimit">0 kr</span>
                </div>
                <div class="result-row">
                    <span class="result-label">M√∂jlig vinst:</span>
                    <span class="result-value positive" id="maxProfit">0 kr</span>
                </div>
                <div class="result-row">
                    <span class="result-label">Risk/Reward:</span>
                    <span class="result-value" id="ratio">1:0</span>
                </div>
            </div>
        </div>
        
        <!-- Section 2: Guides -->
        <div class="card">
            <h2>üìö 2. Guider f√∂r Avanza</h2>
            <p style="color: var(--text-secondary); margin-bottom: 20px;">
                V√§lj vilken guide du beh√∂ver baserat p√• din situation:
            </p>
            
            <!-- Tabs -->
            <div class="tabs">
                <div class="tab active" onclick="switchTab('stopLoss')">
                    üõë S√§tta Stop Loss
                </div>
                <div class="tab" onclick="switchTab('takeProfit')">
                    üéØ S√§tta Take Profit
                </div>
                <div class="tab" onclick="switchTab('buyAndSet')">
                    üöÄ K√∂pa + S√§tta SL/TP
                </div>
            </div>
            
            <!-- Tab Content 1: Stop Loss Guide -->
            <div id="stopLoss" class="tab-content active">
                <div class="alert alert-info">
                    <strong>üìå N√§r anv√§nder jag denna guide?</strong>
                    Du har redan K√ñPT ett certifikat och vill nu skydda dig mot f√∂rluster med Stop Loss.
                </div>
                
                <div class="guide-step">
                    <h4>Steg 1: G√• till ditt innehav</h4>
                    <p>√ñppna Avanza-appen ‚Üí <strong>Portfolio</strong> ‚Üí Hitta ditt certifikat</p>
                </div>
                
                <div class="guide-step">
                    <h4>Steg 2: Tryck p√• "S√§lj"</h4>
                    <p>Tryck p√• den <span class="highlight-red">r√∂da "S√§lj"-knappen</span></p>
                </div>
                
                <div class="guide-step">
                    <h4>Steg 3: Hitta avancerad orderl√§ggning</h4>
                    <p><strong>Scrolla NER</strong> tills du ser:</p>
                    <p style="text-align: center; font-size: 2em; margin: 10px 0;">‚Ä¢ ‚Ä¢ ‚Ä¢</p>
                    <p style="text-align: center; color: var(--avanza-green);">Avancerad orderl√§ggning</p>
                    <p style="margin-top: 10px;"><strong>Tryck p√• de tre punkterna!</strong></p>
                </div>
                
                <div class="guide-step">
                    <h4>Steg 4: V√§lj "Stop Loss"</h4>
                    <p>En meny √∂ppnas. V√§lj alternativet: <strong>Stop Loss</strong></p>
                </div>
                
                <div class="guide-step">
                    <h4>Steg 5: Fyll i v√§rdena</h4>
                    <p><strong>Se till att det st√•r:</strong> "Lika med eller <strong>L√§gre</strong>"</p>
                    <br>
                    <p><strong>F√§lt 1 - TRIGGER (Triggas n√§r priset n√•r):</strong></p>
                    <p>Skriv in: <span class="highlight-red" id="guide-sl-trigger">Ber√§kna f√∂rst ovan</span></p>
                    <br>
                    <p><strong>F√§lt 2 - ANTAL:</strong></p>
                    <p>Skriv in: <span class="highlight-value" id="guide-sl-quantity">Ber√§kna f√∂rst ovan</span></p>
                    <br>
                    <p><strong>F√§lt 3 - KURS (Limit - minimumpris att s√§lja till):</strong></p>
                    <p>Skriv in: <span class="highlight-red" id="guide-sl-limit">Ber√§kna f√∂rst ovan</span></p>
                </div>
                
                <div class="guide-step">
                    <h4>Steg 6: V√§lj giltighet</h4>
                    <p>Scrolla ner och v√§lj: <strong>"G√§ller tills vidare"</strong></p>
                    <p style="margin-top: 8px; color: var(--text-secondary);">üí° Detta g√∂r att ordern stannar aktiv tills den g√•r igenom eller du tar bort den</p>
                </div>
                
                <div class="guide-step">
                    <h4>Steg 7: L√§gg order</h4>
                    <p>Tryck p√• <strong>"Granska s√§lj"</strong></p>
                    <p>Kontrollera att allt st√§mmer ‚Üí Tryck p√• <strong>"L√§gg order"</strong></p>
                </div>
                
                <div class="alert alert-success">
                    <strong>‚úÖ Klart! Stop Loss √§r nu aktiv!</strong>
                    Du √§r skyddad mot stora f√∂rluster. Om priset faller till din trigger-niv√•, s√§ljs certifikatet automatiskt.
                </div>
                
                <div class="alert alert-warning">
                    <strong>‚ö†Ô∏è OBS:</strong> Flytta ALDRIG Stop Loss ned√•t n√§r det g√•r d√•ligt. Det √§r precis d√• den ska skydda dig!
                </div>
            </div>
            
            <!-- Tab Content 2: Take Profit Guide -->
            <div id="takeProfit" class="tab-content">
                <div class="alert alert-info">
                    <strong>üìå N√§r anv√§nder jag denna guide?</strong>
                    Du har redan K√ñPT ett certifikat och vill nu s√§kra din vinst med Take Profit.
                </div>
                
                <div class="alert alert-warning">
                    <strong>‚ö†Ô∏è VIKTIGT!</strong>
                    F√∂r Take Profit anv√§nder du <strong>VANLIG orderl√§ggning</strong>. Tryck INTE p√• tre punkterna (‚Ä¢‚Ä¢‚Ä¢) denna g√•ng!
                </div>
                
                <div class="guide-step">
                    <h4>Steg 1: G√• till ditt innehav</h4>
                    <p>√ñppna Avanza-appen ‚Üí <strong>Portfolio</strong> ‚Üí Hitta ditt certifikat</p>
                </div>
                
                <div class="guide-step">
                    <h4>Steg 2: Tryck p√• "S√§lj"</h4>
                    <p>Tryck p√• den <span class="highlight-red">r√∂da "S√§lj"-knappen</span></p>
                </div>
                
                <div class="guide-step">
                    <h4>Steg 3: Anv√§nd ENKEL orderl√§ggning</h4>
                    <p><strong style="color: var(--avanza-red);">TRYCK INTE</strong> p√• tre punkterna (‚Ä¢‚Ä¢‚Ä¢)!</p>
                    <p>Du ska direkt se f√§lten: <strong>Antal</strong> och <strong>Kurs</strong></p>
                    <p style="margin-top: 8px; color: var(--text-secondary);">üí° Det finns INGET "Trigger"-f√§lt f√∂r Take Profit</p>
                </div>
                
                <div class="guide-step">
                    <h4>Steg 4: Fyll i v√§rdena</h4>
                    <p><strong>F√§lt 1 - ANTAL:</strong></p>
                    <p>Skriv in: <span class="highlight-value" id="guide-tp-quantity">Ber√§kna f√∂rst ovan</span></p>
                    <br>
                    <p><strong>F√§lt 2 - KURS (Limit - pris att s√§lja till):</strong></p>
                    <p>Skriv in: <span class="highlight-value" id="guide-tp-limit">Ber√§kna f√∂rst ovan</span></p>
                    <br>
                    <p><strong>Ordertyp:</strong> Ska automatiskt st√• <strong>Limit</strong> eller <strong>Limitpris</strong></p>
                </div>
                
                <div class="guide-step">
                    <h4>Steg 5: V√§lj giltighet</h4>
                    <p>Scrolla ner och v√§lj: <strong>"G√§ller tills vidare"</strong></p>
                </div>
                
                <div class="guide-step">
                    <h4>Steg 6: L√§gg order</h4>
                    <p>Kontrollera att allt st√§mmer ‚Üí Tryck p√• <strong>"L√§gg order"</strong></p>
                </div>
                
                <div class="alert alert-success">
                    <strong>üéâ Klart! Take Profit √§r nu aktiv!</strong>
                    N√§r priset n√•r din vinstniv√•, s√§ljs certifikatet automatiskt och din vinst √§r s√§krad!
                </div>
                
                <div class="alert alert-warning">
                    <strong>‚ö†Ô∏è VIKTIGT:</strong> N√§r Take Profit g√•r igenom ‚Üí Gl√∂m inte RADERA Stop Loss manuellt! (Annars kan b√•da f√∂rs√∂ka s√§lja)
                </div>
            </div>
            
            <!-- Tab Content 3: Buy & Set Guide -->
            <div id="buyAndSet" class="tab-content">
                <div class="alert alert-info">
                    <strong>üìå N√§r anv√§nder jag denna guide?</strong>
                    Du vill k√∂pa ett certifikat till ett specifikt pris OCH direkt s√§tta b√•de Stop Loss och Take Profit. Detta √§r det KOMPLETTA fl√∂det!
                </div>
                
                <h3 style="color: var(--avanza-blue); margin-top: 20px;">Del 1: K√∂pa till √∂nskat pris üí∞</h3>
                
                <div class="guide-step">
                    <h4>Steg 1.1: S√∂k certifikat</h4>
                    <p>√ñppna Avanza ‚Üí <strong>S√∂k</strong> ‚Üí Skriv certifikatets namn (t.ex. "BULL ASTS X2")</p>
                    <p>Tryck p√• certifikatet f√∂r att √∂ppna det</p>
                </div>
                
                <div class="guide-step">
                    <h4>Steg 1.2: Tryck p√• "K√∂p"</h4>
                    <p>Tryck p√• den <span class="highlight-value">gr√∂na "K√∂p"-knappen</span></p>
                </div>
                
                <div class="guide-step">
                    <h4>Steg 1.3: Fyll i k√∂porder</h4>
                    <p><strong>ANTAL:</strong> Antal certifikat du vill k√∂pa</p>
                    <p>Skriv in: <span class="highlight-value" id="guide-buy-quantity">Ber√§kna f√∂rst ovan</span></p>
                    <br>
                    <p><strong>KURS (Limitpris):</strong> Det pris du √§r villig att betala</p>
                    <p>Skriv in: <span class="highlight-value" id="guide-buy-price">Ber√§kna f√∂rst ovan</span></p>
                    <br>
                    <p style="color: var(--text-secondary);">üí° Om du vill k√∂pa DIREKT till nuvarande pris, l√§mna Kurs tom eller v√§lj "B√§sta"</p>
                </div>
                
                <div class="guide-step">
                    <h4>Steg 1.4: V√§lj giltighet</h4>
                    <p>V√§lj: <strong>"G√§ller tills vidare"</strong> (om du vill v√§nta p√• r√§tt pris)</p>
                    <p>ELLER: <strong>"Dagsorder"</strong> (om du vill k√∂pa idag)</p>
                </div>
                
                <div class="guide-step">
                    <h4>Steg 1.5: L√§gg k√∂porder</h4>
                    <p>Tryck p√• <strong>"Granska k√∂p"</strong> ‚Üí <strong>"L√§gg order"</strong></p>
                </div>
                
                <div class="alert alert-success">
                    <strong>‚úÖ K√∂porder lagd!</strong>
                    V√§nta tills k√∂pet g√•r igenom. Du f√•r en notis n√§r certifikatet √§r k√∂pt.
                </div>
                
                <h3 style="color: var(--avanza-green); margin-top: 30px;">Del 2: S√§tt Stop Loss direkt üõë</h3>
                
                <div class="alert alert-warning">
                    <strong>‚ö†Ô∏è VIKTIGT:</strong> S√§tt Stop Loss DIREKT efter k√∂pet g√•r igenom! V√§nta inte!
                </div>
                
                <div class="guide-step">
                    <h4>Steg 2.1: G√• till Portfolio</h4>
                    <p>Efter k√∂pet ‚Üí G√• till <strong>Portfolio</strong> ‚Üí Hitta ditt certifikat</p>
                </div>
                
                <div class="guide-step">
                    <h4>Steg 2.2 - 2.7: F√∂lj Stop Loss-guiden</h4>
                    <p>G√• till fliken <span class="highlight-value">"S√§tta Stop Loss"</span> och f√∂lj steg-f√∂r-steg instruktionerna d√§r.</p>
                    <p style="margin-top: 10px;">Anv√§nd dessa v√§rden:</p>
                    <p>‚Ä¢ <strong>Trigger:</strong> <span class="highlight-red" id="guide-buy-sl-trigger">Ber√§kna f√∂rst ovan</span></p>
                    <p>‚Ä¢ <strong>Limit:</strong> <span class="highlight-red" id="guide-buy-sl-limit">Ber√§kna f√∂rst ovan</span></p>
                </div>
                
                <h3 style="color: var(--avanza-green); margin-top: 30px;">Del 3: S√§tt Take Profit üéØ</h3>
                
                <div class="guide-step">
                    <h4>Steg 3.1 - 3.6: F√∂lj Take Profit-guiden</h4>
                    <p>G√• till fliken <span class="highlight-value">"S√§tta Take Profit"</span> och f√∂lj steg-f√∂r-steg instruktionerna d√§r.</p>
                    <p style="margin-top: 10px;">Anv√§nd detta v√§rde:</p>
                    <p>‚Ä¢ <strong>Limit:</strong> <span class="highlight-value" id="guide-buy-tp-limit">Ber√§kna f√∂rst ovan</span></p>
                </div>
                
                <div class="alert alert-success">
                    <strong>üéâ KLART! Du har nu:</strong>
                    <ul style="margin-top: 10px; padding-left: 20px;">
                        <li>‚úÖ K√∂pt certifikatet till √∂nskat pris</li>
                        <li>‚úÖ Satt Stop Loss (skydd mot f√∂rluster)</li>
                        <li>‚úÖ Satt Take Profit (s√§krar vinster)</li>
                    </ul>
                    <p style="margin-top: 10px;">Nu kan du koppla av! Ordrarna arbetar automatiskt √•t dig.</p>
                </div>
                
                <div class="alert alert-warning">
                    <strong>üìã Checklist - Kom ih√•g:</strong>
                    <ul style="margin-top: 10px; padding-left: 20px;">
                        <li>F√∂lj positionen dagligen kl 15:30 (n√§r USA √∂ppnar)</li>
                        <li>N√§r EN order g√•r igenom ‚Üí Radera den ANDRA manuellt</li>
                        <li>H√•ll max 3-5 dagar med X2, endast intradag med X5+</li>
                        <li>Flytta INTE Stop Loss ned√•t!</li>
                    </ul>
                </div>
            </div>
        </div>
        
    </div>
    
    <script>
        let selectedRisk = 'balanced';
        let calculatedData = {};
        let currentStock = null;
        
        const riskLevels = {
            low: { stopLoss: 0.10, takeProfit: 0.20 },
            balanced: { stopLoss: 0.15, takeProfit: 0.30 },
            aggressive: { stopLoss: 0.20, takeProfit: 0.40 }
        };
        
        // Select risk level
        function selectRisk(risk) {
            selectedRisk = risk;
            document.querySelectorAll('.risk-option').forEach(option => {
                option.classList.remove('active');
            });
            event.currentTarget.classList.add('active');
        }
        
        // Search stock using Alpha Vantage API (GLOBAL_QUOTE endpoint)
        async function searchStock() {
            const query = document.getElementById('searchInput').value.trim().toUpperCase();
            
            if (!query) {
                alert('Skriv in en ticker-symbol!');
                return;
            }
            
            // Hardcoded API key (hidden from users)
            const apiKey = 'LHBGOUL4ZLHCV9PW';
            
            const loadingDiv = document.getElementById('stockResult');
            loadingDiv.innerHTML = '<div class="loading"><div class="spinner"></div><p>H√§mtar pris...</p></div>';
            loadingDiv.classList.add('show');
            
            try {
                // Alpha Vantage GLOBAL_QUOTE endpoint (from official documentation)
                const alphaUrl = `https://www.alphavantage.co/query?function=GLOBAL_QUOTE&symbol=${encodeURIComponent(query)}&apikey=${apiKey}`;
                
                // Use CORS proxy to bypass CORS restrictions
                const proxyUrl = 'https://api.allorigins.win/raw?url=';
                const url = proxyUrl + encodeURIComponent(alphaUrl);
                
                const response = await fetch(url);
                const data = await response.json();
                
                // Check for API errors
                if (data['Error Message']) {
                    throw new Error('Ticker hittades inte. Kontrollera stavningen.');
                }
                
                if (data['Note']) {
                    throw new Error('API-gr√§ns n√•dd (25 requests/dag). V√§nta och f√∂rs√∂k igen.');
                }
                
                if (data['Information']) {
                    throw new Error('F√∂r m√•nga requests. V√§nta 1 minut och f√∂rs√∂k igen.');
                }
                
                const quote = data['Global Quote'];
                
                if (!quote || !quote['05. price']) {
                    throw new Error('Ingen data hittades f√∂r ' + query);
                }
                
                // Parse Alpha Vantage GLOBAL_QUOTE response
                currentStock = {
                    name: quote['01. symbol'] || query,
                    ticker: quote['01. symbol'] || query,
                    price: parseFloat(quote['05. price']),
                    change: parseFloat(quote['09. change']),
                    changePercent: parseFloat(quote['10. change percent'].replace('%', ''))
                };
                
                displayStockResult();
                
            } catch (error) {
                console.error('Alpha Vantage error:', error);
                loadingDiv.innerHTML = `
                    <div class="loading">
                        <p style="color: var(--avanza-red);">‚ùå ${error.message}</p>
                        <p style="font-size: 0.9em; color: var(--text-secondary); margin-top: 10px;">
                            <strong>Tips:</strong>
                        </p>
                        <ul style="text-align: left; margin: 10px auto; max-width: 400px; color: var(--text-secondary); font-size: 0.9em;">
                            <li>Kontrollera att ticker-symbolen √§r korrekt (t.ex. AAPL f√∂r Apple)</li>
                            <li>Prova med USA-aktier: AAPL, TSLA, MSFT, GOOGL</li>
                            <li>Gratis API: max 25 s√∂kningar/dag</li>
                            <li>Eller fyll i pris manuellt nedan</li>
                        </ul>
                        <button class="button button-primary" onclick="document.getElementById('buyPrice').scrollIntoView({behavior: 'smooth', block: 'center'}); document.getElementById('stockResult').classList.remove('show');" style="max-width: 300px; margin: 15px auto;">
                            Fyll i pris manuellt
                        </button>
                    </div>
                `;
            }
        }
        
        // Display stock result
        function displayStockResult() {
            const s = currentStock;
            const changeColor = s.change >= 0 ? 'var(--avanza-green)' : 'var(--avanza-red)';
            const changeSign = s.change >= 0 ? '+' : '';
            
            // Alpha Vantage primarily returns USD
            const currency = 'USD';
            
            const html = `
                <div class="stock-info">
                    <div class="stock-info-item">
                        <div class="stock-info-label">Ticker</div>
                        <div class="stock-info-value" style="font-size: 1.2em;">${s.ticker}</div>
                    </div>
                    <div class="stock-info-item">
                        <div class="stock-info-label">Pris</div>
                        <div class="stock-info-value">${s.price.toFixed(2)} ${currency}</div>
                    </div>
                    <div class="stock-info-item">
                        <div class="stock-info-label">F√∂r√§ndring</div>
                        <div class="stock-info-value" style="color: ${changeColor};">
                            ${changeSign}${s.change.toFixed(2)} (${changeSign}${s.changePercent.toFixed(2)}%)
                        </div>
                    </div>
                </div>
                <button class="button button-primary" onclick="useStockPrice()" style="margin-top: 15px;">
                    ‚úì Anv√§nd pris ${s.price.toFixed(2)} ${currency} i kalkylatorn
                </button>
            `;
            
            document.getElementById('stockResult').innerHTML = html;
            document.getElementById('stockResult').classList.add('show');
        }
        
        // Use stock price in calculator
        function useStockPrice() {
            if (currentStock) {
                document.getElementById('buyPrice').value = currentStock.price.toFixed(2);
                alert(`‚úÖ Pris ${currentStock.price.toFixed(2)} USD ifyllt i kalkylatorn!`);
                
                // Scroll to calculator
                document.getElementById('buyPrice').scrollIntoView({ behavior: 'smooth', block: 'center' });
            }
        }
        
        // Calculate levels
        function calculate() {
            const buyPrice = parseFloat(document.getElementById('buyPrice').value);
            const quantity = parseInt(document.getElementById('quantity').value);
            
            if (!buyPrice || !quantity) {
                alert('Fyll i Ink√∂pspris och Antal!');
                return;
            }
            
            const risk = riskLevels[selectedRisk];
            const totalInvestment = buyPrice * quantity;
            
            // Stop Loss calculations
            const slTrigger = buyPrice * (1 - risk.stopLoss);
            const slLimit = slTrigger * 0.98; // 2% under trigger f√∂r s√§kerhet
            const maxLoss = totalInvestment * risk.stopLoss;
            
            // Take Profit calculations
            const tpLimit = buyPrice * (1 + risk.takeProfit);
            const maxProfit = totalInvestment * risk.takeProfit;
            
            // Risk/Reward Ratio
            const ratio = (maxProfit / maxLoss).toFixed(2);
            
            calculatedData = {
                buyPrice,
                quantity,
                totalInvestment,
                slTrigger,
                slLimit,
                maxLoss,
                tpLimit,
                maxProfit,
                ratio
            };
            
            updateDisplays();
            
            // Show results
            document.getElementById('results').classList.add('show');
            
            // Scroll to results
            document.getElementById('results').scrollIntoView({ behavior: 'smooth', block: 'nearest' });
        }
        
        // Update all displays with calculated values
        function updateDisplays() {
            const d = calculatedData;
            
            // Results section
            document.getElementById('totalInvestment').textContent = d.totalInvestment.toFixed(2) + ' kr';
            document.getElementById('slTrigger').textContent = d.slTrigger.toFixed(2) + ' kr';
            document.getElementById('slLimit').textContent = d.slLimit.toFixed(2) + ' kr';
            document.getElementById('maxLoss').textContent = '-' + d.maxLoss.toFixed(2) + ' kr';
            document.getElementById('tpLimit').textContent = d.tpLimit.toFixed(2) + ' kr';
            document.getElementById('maxProfit').textContent = '+' + d.maxProfit.toFixed(2) + ' kr';
            document.getElementById('ratio').textContent = '1:' + d.ratio;
            
            // Stop Loss guide
            document.getElementById('guide-sl-trigger').textContent = d.slTrigger.toFixed(2) + ' kr';
            document.getElementById('guide-sl-limit').textContent = d.slLimit.toFixed(2) + ' kr';
            document.getElementById('guide-sl-quantity').textContent = d.quantity + ' st';
            
            // Take Profit guide
            document.getElementById('guide-tp-limit').textContent = d.tpLimit.toFixed(2) + ' kr';
            document.getElementById('guide-tp-quantity').textContent = d.quantity + ' st';
            
            // Buy & Set guide
            document.getElementById('guide-buy-quantity').textContent = d.quantity + ' st';
            document.getElementById('guide-buy-price').textContent = d.buyPrice.toFixed(2) + ' kr';
            document.getElementById('guide-buy-sl-trigger').textContent = d.slTrigger.toFixed(2) + ' kr';
            document.getElementById('guide-buy-sl-limit').textContent = d.slLimit.toFixed(2) + ' kr';
            document.getElementById('guide-buy-tp-limit').textContent = d.tpLimit.toFixed(2) + ' kr';
        }
        
        // Switch tabs
        function switchTab(tabName) {
            // Remove active from all tabs
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Remove active from all tab contents
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            
            // Add active to clicked tab
            event.currentTarget.classList.add('active');
            
            // Show corresponding content
            document.getElementById(tabName).classList.add('active');
            
            // Scroll to guides section
            document.querySelector('.card:nth-child(2)').scrollIntoView({ behavior: 'smooth', block: 'start' });
        }
        
        // Allow search on Enter key
        document.getElementById('searchInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                searchStock();
            }
        });
    </script>
</body>
</html>